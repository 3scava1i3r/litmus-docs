<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>OpenEBS for NuoDB · </title><meta name="viewport" content="width=device-width"/><meta name="generator" content="Docusaurus"/><meta property="og:title" content="OpenEBS for NuoDB · "/><meta property="og:type" content="website"/><meta property="og:url" content="https://docs.openebs.io/index.html"/><meta property="og:description" content="------"/><meta name="twitter:card" content="summary"/><link rel="shortcut icon" href="/img/favicon.ico"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.css"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css"/><link rel="stylesheet" href="/css/code-blocks-buttons.css"/><script type="text/javascript" src="https://buttons.github.io/buttons.js"></script><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.0/clipboard.min.js"></script><script type="text/javascript" src="/js/code-blocks-buttons.js"></script><link rel="stylesheet" href="/css/main.css"/></head><body class="sideNavVisible doc separateOnPageNav"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/"><img id="logo" src="/img/OpenEBS-logo.svg" alt=""/><img class="logo-text" src="/img/openebs-docs-logo.svg" alt=""/><h2 class="headerTitle"></h2></a><div class="dropdown"><span class="ver-link">0.8.1</span><span class="ver-link-span"><i class="arrow down"></i></span><div class="dropdown-menu" id="versions-list" aria-labelledby="dropdownMenuButton"><a class="dropdown-item" id="0" href="https://docs.openebs.io">0.8.1</a><a class="dropdown-item" id="1" href="https://v08-docs.openebs.io">0.8.0</a><a class="dropdown-item" id="2" href="https://v07-docs.openebs.io">0.7.0</a><a class="dropdown-item" id="3" href="https://v06-docs.openebs.io">0.6.0</a><a class="dropdown-item" id="4" href="https://v05-docs.openebs.io">0.5.0</a></div></div><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class="navSearchWrapper reactNavSearchWrapper"><input type="text" id="search_input_react" placeholder="Search" title="Search"/></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><a href="https://app.mayaonline.io" target="_blank" rel="noreferrer noopener"><div class="float rotate"><img src="../../../../../../docs/assets/mo-logo.png" alt="MayaOnline" height="45px" width="45px" title="Connect to MayaOnline"/></div></a><div class="container docsNavContainer" id="docsNav"><nav class="toc"><div class="toggleNav"><section class="navWrapper wrapper"><div class="navBreadcrumb wrapper"><div class="navToggle" id="navToggler"><i></i></div><h2><i>›</i><span>Stateful Applications</span></h2></div><div class="navGroups"><div class="navGroup navGroupActive"><h3 id="Introduction" class="languages-menu">Introduction</h3><div class="hide" id="Introduction dropdown-content-div"><ul id="languages-dropdown-items"><li class="navListItem"><a class="navItem" href="/docs/next/overview.html">Overview</a></li><li class="navListItem"><a class="navItem" href="/docs/next/features.html">Features and Benefits</a></li><li class="navListItem"><a class="navItem" href="/docs/next/usecases.html">Use cases</a></li><li class="navListItem"><a class="navItem" href="/docs/next/releases.html">Releases</a></li><li class="navListItem"><a class="navItem" href="/docs/next/support.html">Support</a></li><li class="navListItem"><a class="navItem" href="/docs/next/mayaonline.html">MayaOnline</a></li></ul></div></div><div class="navGroup navGroupActive"><h3 id="Concepts" class="languages-menu">Concepts</h3><div class="hide" id="Concepts dropdown-content-div"><ul id="languages-dropdown-items"><li class="navListItem"><a class="navItem" href="/docs/next/cas.html">Container Attached Storage</a></li><li class="navListItem"><a class="navItem" href="/docs/next/architecture.html">OpenEBS Architecture</a></li><li class="navListItem"><a class="navItem" href="/docs/next/casengines.html">CAS Engines (cStor &amp; Jiva)</a></li><li class="navListItem"><a class="navItem" href="/docs/next/cstor.html">cStor</a></li><li class="navListItem"><a class="navItem" href="/docs/next/jiva.html">Jiva</a></li></ul></div></div><div class="navGroup navGroupActive"><h3 id="User Guides" class="languages-menu">User Guides</h3><div class="hide" id="User Guides dropdown-content-div"><ul id="languages-dropdown-items"><li class="navListItem"><a class="navItem" href="/docs/next/quickstart.html">Quickstart</a></li><li class="navListItem"><a class="navItem" href="/docs/next/prerequisites.html">Prerequisites</a></li><li class="navListItem"><a class="navItem" href="/docs/next/installation.html">Installation</a></li><li class="navListItem"><a class="navItem" href="/docs/next/configurepools.html">Configure StoragePools</a></li><li class="navListItem"><a class="navItem" href="/docs/next/configuresc.html">Configuring StorageClasses</a></li><li class="navListItem"><a class="navItem" href="/docs/next/provisionvols.html">Provisioning Volumes</a></li><li class="navListItem"><a class="navItem" href="/docs/next/operations.html">Day 2 Operations</a></li><li class="navListItem"><a class="navItem" href="/docs/next/jivaguide.html">Jiva user guide</a></li><li class="navListItem"><a class="navItem" href="/docs/next/mayactl.html">Mayactl</a></li><li class="navListItem"><a class="navItem" href="/docs/next/backup.html">Backup and Restore</a></li><li class="navListItem"><a class="navItem" href="/docs/next/upgrade.html">Upgrade</a></li><li class="navListItem"><a class="navItem" href="/docs/next/uninstall.html">Uninstall</a></li></ul></div></div><div class="navGroup navGroupActive"><h3 id="Stateful Applications" class="languages-menu">Stateful Applications</h3><div class="hide" id="Stateful Applications dropdown-content-div"><ul id="languages-dropdown-items"><li class="navListItem"><a class="navItem" href="/docs/next/mysql.html">RDS like MySQL</a></li><li class="navListItem"><a class="navItem" href="/docs/next/prometheus.html">Prometheus</a></li><li class="navListItem"><a class="navItem" href="/docs/next/minio.html">Minio</a></li><li class="navListItem"><a class="navItem" href="/docs/next/gitlab.html">GitLab</a></li><li class="navListItem"><a class="navItem" href="/docs/next/percona.html">Percona</a></li><li class="navListItem"><a class="navItem" href="/docs/next/elasticsearch.html">ElasticSearch</a></li><li class="navListItem"><a class="navItem" href="/docs/next/cassandra.html">Cassandra</a></li><li class="navListItem navListItemActive"><a class="navItem navItemActive" href="/docs/next/nuodb.html">NuoDB</a></li><li class="navListItem"><a class="navItem" href="/docs/next/postgres.html">PostgreSQL</a></li><li class="navListItem"><a class="navItem" href="/docs/next/redis.html">Redis</a></li><li class="navListItem"><a class="navItem" href="/docs/next/mongo.html">MongoDB</a></li><li class="navListItem"><a class="navItem" href="/docs/next/rwm.html">Read-Write-Many (RWM)</a></li></ul></div></div><div class="navGroup navGroupActive"><h3 id="Advanced Topics" class="languages-menu">Advanced Topics</h3><div class="hide" id="Advanced Topics dropdown-content-div"><ul id="languages-dropdown-items"><li class="navListItem"><a class="navItem" href="/docs/next/performance.html">Performance testing</a></li><li class="navListItem"><a class="navItem" href="/docs/next/faq.html">FAQs</a></li><li class="navListItem"><a class="navItem" href="/docs/next/k8supgrades.html">Kubernetes upgrades</a></li><li class="navListItem"><a class="navItem" href="/docs/next/troubleshooting.html">Troubleshooting</a></li></ul></div></div></div></section></div><script>
          var toggler = document.getElementById('navToggler');
          var nav = document.getElementById('docsNav');
          toggler.onclick = function() {
            nav.classList.toggle('docsSliderActive');
          };
        </script><script>
            var navGroupElem = document.getElementsByClassName("hide");
            for(var k=0; k<navGroupElem.length; k++){
              if (navGroupElem[k].innerHTML.indexOf("navItem navItemActive") != -1) {
                document.getElementById(navGroupElem[k].id).className = "visible";
              }
            }
            var elem = document.getElementsByClassName("languages-menu");
            for (var i=0; i < elem.length; i++){
              document.getElementById(String(elem[i].id)).addEventListener("click", function() {
                sessionStorage.setItem("name", document.getElementById(this.id+" dropdown-content-div").className);
                sessionStorage.setItem("Id", document.getElementById(this.id).id);
                if ( document.getElementById(this.id+" dropdown-content-div").className == "hide") {
                  document.getElementById(this.id+" dropdown-content-div").className = "visible";
                }
                else {
                  document.getElementById(this.id+" dropdown-content-div").className = "hide";
                }
            })};</script><script>
          var SelectedItemClassName = sessionStorage.getItem("name");
          var SelectedItemId = sessionStorage.getItem("Id");
          if (SelectedItemClassName == "hide"){
            document.getElementById( SelectedItemId +" dropdown-content-div").className = "visible";
          }
        </script></nav></div><div class="container mainContainer"><div class="wrapper"><div class="post"><header class="postHeader"><a class="edit-page-link button" href="https://github.com/openebs/openebs-docs/edit/staging/docs/nuodb.md" target="_blank" rel="noreferrer noopener">Edit</a><a class="edit-page-link button" href="https://github.com/openebs/openebs/issues/new/" target="_blank" rel="noreferrer noopener">Create An Issue</a><h1>OpenEBS for NuoDB</h1></header><article><div><span><hr>
<p><img src="/docs/assets/o-nuodb.png" alt="OpenEBS and Nuodb" style="width:400px;"></p>
<p><br></p>
<h2><a class="anchor" aria-hidden="true" id="introduction"></a><a href="#introduction" aria-hidden="true" class="hash-link" ><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Introduction</h2>
<p>NuoDB’s distributed SQL database combines the elastic scale and continuous availability of the cloud with the transactional consistency and durability that databases of record demand. NuoDB is deployed usually as a <code>statefulset</code> on Kubernetes and requires persistent storage for each instance of NuoDB StorageManager instance. OpenEBS provides persistent volumes on the fly when StorageManagers are scaled up.</p>
<p><br></p>
<p><strong>Advantages of using OpenEBS for NuoDB database:</strong></p>
<ul>
<li>No need to manage the local disks, they are managed by OpenEBS</li>
<li>Large size PVs can be provisioned by OpenEBS and NuoDB</li>
<li>Start with small storage and add disks as needed on the fly. Sometimes NuoDB instances are scaled up because of capacity on the nodes. With OpenEBS persistent volumes, capacity can be thin provisioned and disks can be added to OpenEBS on the fly without disruption of service</li>
<li>NuoDB sometimes need highly available storage, in such cases OpenEBS volumes can be configured with 3 replicas.</li>
<li>If required, take backup of the NuoDB data periodically and back them up to S3 or any object storage so that restoration of the same data is possible to the same or any other Kubernetes cluster</li>
</ul>
<p><br></p>
<p><em>Note: NuoDB can be deployed both as <code>deployment</code> or as <code>statefulset</code>. When NuoDB deployed as <code>statefulset</code>, you don't need to replicate the data again at OpenEBS level. When NuoDB is deployed as <code>deployment</code>, consider 3 OpenEBS replicas, choose the StorageClass accordingly.</em></p>
<p><br></p>
<hr>
<p><br></p>
<h2><a class="anchor" aria-hidden="true" id="deployment-model"></a><a href="#deployment-model" aria-hidden="true" class="hash-link" ><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Deployment model</h2>
<p><br></p>
<p><img src="/docs/assets/svg/nuodb-deployment.svg" alt="OpenEBS and ElasticSearch" style="width:100%;"></p>
<p><br></p>
<hr>
<p><br></p>
<h2><a class="anchor" aria-hidden="true" id="configuration-workflow"></a><a href="#configuration-workflow" aria-hidden="true" class="hash-link" ><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Configuration workflow</h2>
<ol>
<li><p><strong>Install OpenEBS</strong></p>
<p>If OpenEBS is not installed in your K8s cluster, this can done from <a href="/docs/next/installation.html">here</a>. If OpenEBS is already installed, go to the next step.</p></li>
<li><p><strong>Connect to MayaOnline (Optional)</strong> : Connecting the Kubernetes cluster to <a href="https://staging-docs.openebs.io/docs/next/app.mayaonline.io">MayaOnline</a> provides good visibility of storage resources. MayaOnline has various <strong>support options for enterprise customers</strong>.</p></li>
<li><p><strong>Configure cStor Pool</strong></p>
<p>After OpenEBS installation, cStor pool has to be configured.If cStor Pool is not configure in your OpenEBS cluster, this can be done from <a href="/docs/next/configurepools.html">here</a>. Sample YAML named <strong>openebs-config.yaml</strong> for configuring cStor Pool is provided in the Configuration details below. During cStor Pool creation, make sure that the maxPools parameter is set to &gt;=3. If cStor pool is already configured, go to the next step.</p></li>
<li><p><strong>Create Storage Class</strong></p>
<p>You must configure a StorageClass to provision cStor volume on given cStor pool. StorageClass is the interface through which most of the OpenEBS storage policies are defined. In this solution we are using a StorageClass to consume the cStor Pool which is created using external disks attached on the Nodes.  Since NuoDB is a statefulset application, it requires only single storage replica. So cStor volume <code>replicaCount</code> is =1. Sample YAML named <strong>openebs-sc-disk.yaml</strong> to consume cStor pool with cStoveVolume Replica count as 1 is provided in the configuration details below.</p></li>
<li><p>Download the YAML spec files from OpenEBS litmus repository.</p>
<pre><code class="hljs">wget <span class="hljs-symbol">https:</span>/<span class="hljs-regexp">/raw.githubusercontent.com/openebs</span><span class="hljs-regexp">/litmus/master</span><span class="hljs-regexp">/apps/nuodb</span><span class="hljs-regexp">/deployers/nuodb</span>.yaml

wget <span class="hljs-symbol">https:</span>/<span class="hljs-regexp">/raw.githubusercontent.com/openebs</span><span class="hljs-regexp">/litmus/master</span><span class="hljs-regexp">/apps/nuodb</span><span class="hljs-regexp">/deployers/nuodb</span>-sm.yaml

wget <span class="hljs-symbol">https:</span>/<span class="hljs-regexp">/raw.githubusercontent.com/openebs</span><span class="hljs-regexp">/litmus/master</span><span class="hljs-regexp">/apps/nuodb</span><span class="hljs-regexp">/deployers/nuodb</span>-te.yaml
</code></pre></li>
<li><p>Edit the above YAML spec files and update them with correct StorageClass. For example, replace <code>openebs-cstor-sparse</code>  with  <code>openebs-cstor-disk</code></p></li>
<li><p><strong>Launch and test NuoDB</strong></p>
<p>Create a namespace called <strong>testns</strong> and  apply following YAML files to deploy NuoDB application. Sample YAML files are provided in the Configuration details below.</p>
<pre><code class="hljs">kubectl apply -f nuodb<span class="hljs-selector-class">.yaml</span> -n testns
kubectl apply -f nuodb-sm<span class="hljs-selector-class">.yaml</span> -n testns
kubectl apply -f nuodb-te<span class="hljs-selector-class">.yaml</span> -n testns
</code></pre></li>
</ol>
<p><br></p>
<hr>
<p><br></p>
<h2><a class="anchor" aria-hidden="true" id="reference-at-openebsci-https-openebsci"></a><a href="#reference-at-openebsci-https-openebsci" aria-hidden="true" class="hash-link" ><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Reference at <a href="https://openebs.ci/">openebs.ci</a></h2>
<p>Deployment YAML spec files for NuoDB and OpenEBS resources are found <a href="https://github.com/openebs/litmus/blob/master/apps/nuodb/deployers/nuodb.yaml">here</a></p>
<p><a href="https://openebs.ci/nuodb-cstor">OpenEBS-CI dashboard of NuoDB</a></p>
<p><a href="https://insights.nuodb.com/3N5YV375G0/">Live access to NuoDB dashboard</a></p>
<p><br></p>
<hr>
<p><br></p>
<h2><a class="anchor" aria-hidden="true" id="post-deployment-operations"></a><a href="#post-deployment-operations" aria-hidden="true" class="hash-link" ><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Post deployment Operations</h2>
<p><br></p>
<p><strong>Monitor OpenEBS Volume size</strong></p>
<p>It is not seamless to increase the cStor volume size (refer to the roadmap item). Hence, it is recommended that sufficient size is allocated during the initial configuration. However, an alert can be setup for volume size threshold using MayaOnline.</p>
<p><strong>Monitor cStor Pool size</strong></p>
<p>As in most cases, cStor pool may not be dedicated to just NuoDB database alone. It is recommended to watch the pool capacity and add more disks to the pool before it hits 80% threshold. See <a href="/docs/next/configurepools.html#verifying-pool-status">cStorPool metrics</a></p>
<p><br></p>
<hr>
<p><br></p>
<h2><a class="anchor" aria-hidden="true" id="configuration-details"></a><a href="#configuration-details" aria-hidden="true" class="hash-link" ><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Configuration details</h2>
<p><br></p>
<p><strong>openebs-config.yaml</strong></p>
<pre><code class="hljs"><span class="hljs-comment">#Use the following YAMLs to create a cStor Storage Pool.</span>
<span class="hljs-comment"># and associated storage class.</span>
<span class="hljs-attr">apiVersion:</span> <span class="hljs-string">openebs.io/v1alpha1</span>
<span class="hljs-attr">kind:</span> <span class="hljs-string">StoragePoolClaim</span>
<span class="hljs-attr">metadata:</span>
<span class="hljs-attr">  name:</span> <span class="hljs-string">cstor-disk</span>
<span class="hljs-attr">spec:</span>
<span class="hljs-attr">  name:</span> <span class="hljs-string">cstor-disk</span>
<span class="hljs-attr">  type:</span> <span class="hljs-string">disk</span>
<span class="hljs-attr">  poolSpec:</span>
<span class="hljs-attr">    poolType:</span> <span class="hljs-string">striped</span>
  <span class="hljs-comment"># NOTE - Appropriate disks need to be fetched using `kubectl get disks`</span>
  <span class="hljs-comment">#</span>
  <span class="hljs-comment"># `Disk` is a custom resource supported by OpenEBS with `node-disk-manager`</span>
  <span class="hljs-comment"># as the disk operator</span>
<span class="hljs-comment"># Replace the following with actual disk CRs from your cluster `kubectl get disks`</span>
<span class="hljs-comment"># Uncomment the below lines after updating the actual disk names.</span>
<span class="hljs-attr">  disks:</span>
<span class="hljs-attr">    diskList:</span>
<span class="hljs-comment"># Replace the following with actual disk CRs from your cluster from `kubectl get disks`</span>
<span class="hljs-comment">#   - disk-184d99015253054c48c4aa3f17d137b1</span>
<span class="hljs-comment">#   - disk-2f6bced7ba9b2be230ca5138fd0b07f1</span>
<span class="hljs-comment">#   - disk-806d3e77dd2e38f188fdaf9c46020bdc</span>
<span class="hljs-comment">#   - disk-8b6fb58d0c4e0ff3ed74a5183556424d</span>
<span class="hljs-comment">#   - disk-bad1863742ce905e67978d082a721d61</span>
<span class="hljs-comment">#   - disk-d172a48ad8b0fb536b9984609b7ee653</span>
<span class="hljs-meta">---</span>
</code></pre>
<p><strong>openebs-sc-disk.yaml</strong></p>
<pre><code class="hljs"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">storage.k8s.io/v1</span>
<span class="hljs-attr">kind:</span> <span class="hljs-string">StorageClass</span>
<span class="hljs-attr">metadata:</span>
<span class="hljs-attr">  name:</span> <span class="hljs-string">openebs-cstor-disk</span>
<span class="hljs-attr">  annotations:</span>
    <span class="hljs-string">openebs.io/cas-type:</span> <span class="hljs-string">cstor</span>
    <span class="hljs-string">cas.openebs.io/config:</span> <span class="hljs-string">|
</span><span class="hljs-attr">      - name:</span> <span class="hljs-string">StoragePoolClaim</span>
<span class="hljs-attr">        value:</span> <span class="hljs-string">"cstor-disk"</span>
<span class="hljs-attr">      - name:</span> <span class="hljs-string">ReplicaCount</span>
<span class="hljs-attr">        value:</span> <span class="hljs-string">"1"</span>       
<span class="hljs-attr">provisioner:</span> <span class="hljs-string">openebs.io/provisioner-iscsi</span>
<span class="hljs-attr">reclaimPolicy:</span> <span class="hljs-string">Delete</span>
<span class="hljs-meta">---</span>
</code></pre>
<p><strong>nuodb.yaml</strong></p>
<pre><code class="hljs"><span class="hljs-meta">---</span>
<span class="hljs-attr">apiVersion:</span> <span class="hljs-string">v1</span>
<span class="hljs-attr">kind:</span> <span class="hljs-string">Service</span>
<span class="hljs-attr">metadata:</span>
<span class="hljs-attr">  annotations:</span>
<span class="hljs-attr">    description:</span> <span class="hljs-string">|
      Headless service permitting us to retrieve DNS A records that point directly to the pods backing the service.
    "service.alpha.kubernetes.io/tolerate-unready-endpoints": "true"
</span><span class="hljs-attr">  name:</span> <span class="hljs-string">domain</span>
<span class="hljs-attr">  labels:</span>
<span class="hljs-attr">    app:</span> <span class="hljs-string">nuodb</span>
<span class="hljs-attr">    group:</span> <span class="hljs-string">nuodb</span>
<span class="hljs-attr">spec:</span>
<span class="hljs-attr">  clusterIP:</span> <span class="hljs-string">None</span>
<span class="hljs-attr">  ports:</span>
<span class="hljs-bullet">  -</span> <span class="hljs-string">{</span> <span class="hljs-attr">name:</span> <span class="hljs-number">8888</span><span class="hljs-bullet">-tcp,</span>   <span class="hljs-attr">port:</span> <span class="hljs-number">8888</span><span class="hljs-string">,</span>   <span class="hljs-attr">protocol:</span> <span class="hljs-string">TCP,</span>  <span class="hljs-attr">targetPort:</span> <span class="hljs-number">8888</span>  <span class="hljs-string">}</span>
<span class="hljs-bullet">  -</span> <span class="hljs-string">{</span> <span class="hljs-attr">name:</span> <span class="hljs-number">48004</span><span class="hljs-bullet">-tcp,</span>  <span class="hljs-attr">port:</span> <span class="hljs-number">48004</span><span class="hljs-string">,</span>  <span class="hljs-attr">protocol:</span> <span class="hljs-string">TCP,</span>  <span class="hljs-attr">targetPort:</span> <span class="hljs-number">48004</span> <span class="hljs-string">}</span>
<span class="hljs-bullet">  -</span> <span class="hljs-string">{</span> <span class="hljs-attr">name:</span> <span class="hljs-number">48005</span><span class="hljs-bullet">-tcp,</span>  <span class="hljs-attr">port:</span> <span class="hljs-number">48005</span><span class="hljs-string">,</span>  <span class="hljs-attr">protocol:</span> <span class="hljs-string">TCP,</span>  <span class="hljs-attr">targetPort:</span> <span class="hljs-number">48005</span> <span class="hljs-string">}</span>
<span class="hljs-attr">  selector:</span>
<span class="hljs-attr">    dns:</span> <span class="hljs-string">domain</span>
<span class="hljs-attr">  sessionAffinity:</span> <span class="hljs-string">None</span>
<span class="hljs-attr">  type:</span> <span class="hljs-string">ClusterIP</span>
<span class="hljs-attr">status:</span>
<span class="hljs-attr">  loadBalancer:</span> <span class="hljs-string">{}</span>

<span class="hljs-meta">---</span>
<span class="hljs-attr">apiVersion:</span> <span class="hljs-string">v1</span>
<span class="hljs-attr">kind:</span> <span class="hljs-string">Service</span>
<span class="hljs-attr">metadata:</span>
<span class="hljs-attr">  annotations:</span>
<span class="hljs-attr">    description:</span> <span class="hljs-string">"Service (and load-balancer) for Admin pods."</span>
<span class="hljs-attr">  labels:</span>
<span class="hljs-attr">    app:</span> <span class="hljs-string">nuodb</span>
<span class="hljs-attr">    group:</span> <span class="hljs-string">nuodb</span>
<span class="hljs-attr">  name:</span> <span class="hljs-string">admin</span>
<span class="hljs-attr">spec:</span>
<span class="hljs-attr">  ports:</span>
<span class="hljs-bullet">  -</span> <span class="hljs-string">{</span> <span class="hljs-attr">name:</span> <span class="hljs-number">8888</span><span class="hljs-bullet">-tcp,</span>   <span class="hljs-attr">port:</span> <span class="hljs-number">8888</span><span class="hljs-string">,</span>   <span class="hljs-attr">protocol:</span> <span class="hljs-string">TCP,</span>  <span class="hljs-attr">targetPort:</span> <span class="hljs-number">8888</span>  <span class="hljs-string">}</span>
<span class="hljs-bullet">  -</span> <span class="hljs-string">{</span> <span class="hljs-attr">name:</span> <span class="hljs-number">48004</span><span class="hljs-bullet">-tcp,</span>  <span class="hljs-attr">port:</span> <span class="hljs-number">48004</span><span class="hljs-string">,</span>  <span class="hljs-attr">protocol:</span> <span class="hljs-string">TCP,</span>  <span class="hljs-attr">targetPort:</span> <span class="hljs-number">48004</span> <span class="hljs-string">}</span>
<span class="hljs-bullet">  -</span> <span class="hljs-string">{</span> <span class="hljs-attr">name:</span> <span class="hljs-number">48005</span><span class="hljs-bullet">-tcp,</span>  <span class="hljs-attr">port:</span> <span class="hljs-number">48005</span><span class="hljs-string">,</span>  <span class="hljs-attr">protocol:</span> <span class="hljs-string">TCP,</span>  <span class="hljs-attr">targetPort:</span> <span class="hljs-number">48005</span> <span class="hljs-string">}</span>
<span class="hljs-attr">  selector:</span>
<span class="hljs-attr">    app:</span> <span class="hljs-string">admin</span>
<span class="hljs-attr">  sessionAffinity:</span> <span class="hljs-string">None</span>
<span class="hljs-attr">  type:</span> <span class="hljs-string">LoadBalancer</span>
<span class="hljs-attr">status:</span>
<span class="hljs-attr">  loadBalancer:</span> <span class="hljs-string">{}</span>

<span class="hljs-meta">---</span>
<span class="hljs-attr">apiVersion:</span> <span class="hljs-string">apps/v1beta1</span>
<span class="hljs-attr">kind:</span> <span class="hljs-string">StatefulSet</span>
<span class="hljs-attr">metadata:</span>
<span class="hljs-attr">  name:</span> <span class="hljs-string">admin</span>
<span class="hljs-attr">  labels:</span>
<span class="hljs-attr">    app:</span> <span class="hljs-string">nuodb</span>
<span class="hljs-attr">    group:</span> <span class="hljs-string">nuodb</span>
<span class="hljs-attr">spec:</span>
<span class="hljs-attr">  serviceName:</span> <span class="hljs-string">domain</span>
<span class="hljs-attr">  replicas:</span> <span class="hljs-number">1</span>
<span class="hljs-attr">  selector:</span>
<span class="hljs-attr">    matchLabels:</span>
<span class="hljs-attr">      affinity:</span> <span class="hljs-string">admin</span>
<span class="hljs-attr">  template:</span>
<span class="hljs-attr">    metadata:</span>
<span class="hljs-attr">      labels:</span>
<span class="hljs-attr">        dns:</span> <span class="hljs-string">domain</span>
<span class="hljs-attr">        app:</span> <span class="hljs-string">admin</span>
<span class="hljs-attr">        affinity:</span> <span class="hljs-string">admin</span>
<span class="hljs-attr">    spec:</span>
<span class="hljs-attr">      securityContext:</span>
<span class="hljs-attr">        runAsUser:</span> <span class="hljs-number">1000</span>
<span class="hljs-attr">        fsGroup:</span> <span class="hljs-number">0</span>
<span class="hljs-attr">      containers:</span>
<span class="hljs-attr">      - name:</span> <span class="hljs-string">admin</span>
<span class="hljs-attr">        image:</span> <span class="hljs-string">nuodb/nuodb-ce:latest</span>
<span class="hljs-attr">        imagePullPolicy:</span> <span class="hljs-string">IfNotPresent</span>
<span class="hljs-attr">        ports:</span>
<span class="hljs-bullet">        -</span> <span class="hljs-string">{</span> <span class="hljs-attr">containerPort:</span> <span class="hljs-number">8888</span><span class="hljs-string">,</span>  <span class="hljs-attr">protocol:</span> <span class="hljs-string">TCP</span> <span class="hljs-string">}</span>
<span class="hljs-bullet">        -</span> <span class="hljs-string">{</span> <span class="hljs-attr">containerPort:</span> <span class="hljs-number">48004</span><span class="hljs-string">,</span> <span class="hljs-attr">protocol:</span> <span class="hljs-string">TCP</span> <span class="hljs-string">}</span>
<span class="hljs-bullet">        -</span> <span class="hljs-string">{</span> <span class="hljs-attr">containerPort:</span> <span class="hljs-number">48005</span><span class="hljs-string">,</span> <span class="hljs-attr">protocol:</span> <span class="hljs-string">TCP</span> <span class="hljs-string">}</span>
<span class="hljs-attr">        resources:</span>
<span class="hljs-attr">          requests:</span>
<span class="hljs-attr">            memory:</span> <span class="hljs-string">"512Mi"</span>
<span class="hljs-attr">            cpu:</span> <span class="hljs-string">"0.5"</span>
<span class="hljs-attr">          limits:</span>
<span class="hljs-attr">            memory:</span> <span class="hljs-string">"1024Mi"</span>
<span class="hljs-attr">            cpu:</span> <span class="hljs-string">"1"</span>
<span class="hljs-attr">        env:</span>
<span class="hljs-attr">        - name:</span> <span class="hljs-string">NODE_NAME</span>
<span class="hljs-attr">          valueFrom:</span>
<span class="hljs-attr">            fieldRef:</span>
<span class="hljs-attr">              fieldPath:</span> <span class="hljs-string">spec.nodeName</span>
<span class="hljs-attr">        - name:</span> <span class="hljs-string">POD_NAME</span>
<span class="hljs-attr">          valueFrom:</span>
<span class="hljs-attr">            fieldRef:</span>
<span class="hljs-attr">              fieldPath:</span> <span class="hljs-string">metadata.name</span>
<span class="hljs-attr">        - name:</span> <span class="hljs-string">NAMESPACE</span>
<span class="hljs-attr">          valueFrom:</span>
<span class="hljs-attr">            fieldRef:</span>
<span class="hljs-attr">              fieldPath:</span> <span class="hljs-string">metadata.namespace</span>
<span class="hljs-bullet">        -</span> <span class="hljs-string">{</span> <span class="hljs-attr">name:</span> <span class="hljs-string">NUODB_DOMAIN_ENTRYPOINT,</span>      <span class="hljs-attr">value:</span> <span class="hljs-string">"admin-0.domain"</span> <span class="hljs-string">}</span>
<span class="hljs-bullet">        -</span> <span class="hljs-string">{</span> <span class="hljs-attr">name:</span> <span class="hljs-string">NUODB_ALT_ADDRESS,</span>            <span class="hljs-attr">value:</span> <span class="hljs-string">"$(POD_NAME).domain.testns.svc"</span> <span class="hljs-string">}</span>
<span class="hljs-bullet">        -</span> <span class="hljs-string">{</span> <span class="hljs-attr">name:</span> <span class="hljs-string">NUODB_VARDIR,</span>                 <span class="hljs-attr">value:</span> <span class="hljs-string">"/var/opt/nuodb/$(POD_NAME).testns"</span> <span class="hljs-string">}</span>
<span class="hljs-attr">        args:</span> <span class="hljs-string">[</span> <span class="hljs-string">"nuoadmin"</span> <span class="hljs-string">]</span>
<span class="hljs-attr">        livenessProbe:</span>
<span class="hljs-attr">          initialDelaySeconds:</span> <span class="hljs-number">30</span>
<span class="hljs-attr">          periodSeconds:</span> <span class="hljs-number">15</span>
<span class="hljs-attr">          tcpSocket:</span>
<span class="hljs-attr">            port:</span> <span class="hljs-number">8888</span>
<span class="hljs-attr">        readinessProbe:</span>
<span class="hljs-attr">          initialDelaySeconds:</span> <span class="hljs-number">30</span>
<span class="hljs-attr">          periodSeconds:</span> <span class="hljs-number">15</span>
<span class="hljs-attr">          exec:</span>
<span class="hljs-attr">            command:</span> <span class="hljs-string">[</span> <span class="hljs-string">"nuodocker"</span><span class="hljs-string">,</span> <span class="hljs-string">"check"</span><span class="hljs-string">,</span> <span class="hljs-string">"servers"</span> <span class="hljs-string">]</span>
<span class="hljs-attr">        volumeMounts:</span>
<span class="hljs-attr">        - name:</span> <span class="hljs-string">raftlog</span>
<span class="hljs-attr">          mountPath:</span> <span class="hljs-string">/var/opt/nuodb</span>
<span class="hljs-attr">        - name:</span> <span class="hljs-string">log-volume</span>
<span class="hljs-attr">          mountPath:</span> <span class="hljs-string">/var/log/nuodb</span>
<span class="hljs-attr">      volumes:</span>
<span class="hljs-attr">        - name:</span> <span class="hljs-string">log-volume</span>
<span class="hljs-attr">          emptyDir:</span> <span class="hljs-string">{}</span>
<span class="hljs-attr">  volumeClaimTemplates:</span>
<span class="hljs-attr">  - metadata:</span>
<span class="hljs-attr">      name:</span> <span class="hljs-string">raftlog</span>
<span class="hljs-attr">      annotations:</span>
        <span class="hljs-string">volume.beta.kubernetes.io/storage-class:</span> <span class="hljs-string">openebs-cstor-sparse</span>
<span class="hljs-attr">    spec:</span>
<span class="hljs-attr">      accessModes:</span> <span class="hljs-string">[</span> <span class="hljs-string">"ReadWriteOnce"</span> <span class="hljs-string">]</span>
<span class="hljs-attr">      resources:</span>
<span class="hljs-attr">        requests:</span>
<span class="hljs-attr">          storage:</span> <span class="hljs-number">5</span><span class="hljs-string">G</span>
<span class="hljs-meta">---</span>
<span class="hljs-attr">apiVersion:</span> <span class="hljs-string">v1</span>
<span class="hljs-attr">kind:</span> <span class="hljs-string">Service</span>
<span class="hljs-attr">metadata:</span>
<span class="hljs-attr">  annotations:</span>
<span class="hljs-attr">    description:</span> <span class="hljs-string">"Service for redirect."</span>
<span class="hljs-attr">  labels:</span>
<span class="hljs-attr">    app:</span> <span class="hljs-string">insights</span>
<span class="hljs-attr">    group:</span> <span class="hljs-string">nuodb</span>
<span class="hljs-attr">  name:</span> <span class="hljs-string">insights-server</span>
<span class="hljs-attr">spec:</span>
<span class="hljs-attr">  ports:</span>
<span class="hljs-bullet">  -</span> <span class="hljs-string">{</span> <span class="hljs-attr">name:</span> <span class="hljs-number">8080</span><span class="hljs-bullet">-tcp,</span>   <span class="hljs-attr">port:</span> <span class="hljs-number">8080</span><span class="hljs-string">,</span>   <span class="hljs-attr">protocol:</span> <span class="hljs-string">TCP,</span>  <span class="hljs-attr">targetPort:</span> <span class="hljs-number">8080</span>  <span class="hljs-string">}</span>
<span class="hljs-attr">  selector:</span>
<span class="hljs-attr">    app:</span> <span class="hljs-string">insights</span>
<span class="hljs-attr">    group:</span> <span class="hljs-string">nuodb</span>
<span class="hljs-attr">  sessionAffinity:</span> <span class="hljs-string">None</span>
<span class="hljs-attr">  type:</span> <span class="hljs-string">LoadBalancer</span>
<span class="hljs-attr">status:</span>
<span class="hljs-attr">  loadBalancer:</span> <span class="hljs-string">{}</span>

<span class="hljs-meta">---</span>
<span class="hljs-attr">apiVersion:</span> <span class="hljs-string">v1</span>
<span class="hljs-attr">kind:</span> <span class="hljs-string">ConfigMap</span>
<span class="hljs-attr">metadata:</span>
<span class="hljs-attr">  annotations:</span>
<span class="hljs-attr">    description:</span> <span class="hljs-string">"Config map for metrics input and insights output"</span>
<span class="hljs-attr">  name:</span> <span class="hljs-string">insights-configmap</span>
<span class="hljs-attr">  labels:</span>
<span class="hljs-attr">    group:</span> <span class="hljs-string">nuodb</span>
<span class="hljs-attr">data:</span>
  <span class="hljs-string">nuoca.yml.template:</span> <span class="hljs-string">|
    ---
</span><span class="hljs-attr">    NUOCA_LOGFILE:</span> <span class="hljs-string">/var/log/nuodb/nuoca.log</span>

<span class="hljs-attr">    INPUT_PLUGINS:</span>
<span class="hljs-attr">    - NuoAdminNuoMon:</span>
       <span class="hljs-string">description</span> <span class="hljs-string">:</span> <span class="hljs-string">Collection</span> <span class="hljs-string">from</span> <span class="hljs-string">NuoDB</span> <span class="hljs-string">engines</span>
<span class="hljs-attr">       nuocaCollectionName:</span> <span class="hljs-string">NuoMon</span>
<span class="hljs-attr">       api_server:</span> <span class="hljs-attr">https://domain:8888</span>
<span class="hljs-attr">       client_key:</span>  <span class="hljs-string">/etc/nuodb/keys/nuocmd.pem</span>
<span class="hljs-attr">    OUTPUT_PLUGINS:</span>
<span class="hljs-attr">    - RestClient:</span>
<span class="hljs-attr">        url:</span> <span class="hljs-string">${INSIGHTS_INGEST_URL}</span>
<span class="hljs-attr">  nuoinsights:</span> <span class="hljs-string">|
    #!/bin/bash
    . ${NUODB_HOME}/etc/nuodb_setup.sh
    : ${NUOCMD_API_SERVER:=https://domain:8888}

    SCRIPT=$(cat &lt;&lt;EOF
    from BaseHTTPServer import BaseHTTPRequestHandler,HTTPServer
    from nuoca import NuoCA as nuoca
    import nuodb_mgmt

    PORT_NUMBER = 8080

    def get_insights_dashboard():
      conn = nuodb_mgmt.AdminConnection('${NUOCMD_API_SERVER}', '/etc/nuodb/keys/nuocmd.pem')
      metadata = nuoca.get_insights_metadata(conn)
      return metadata.get(nuoca.INSIGHTS_DASHBOARD_KEY,None)

      #ingest_url    = metadata[nuoca.INSIGHTS_URL_KEY]
      #subscriber_id = metadata[nuoca.INSIGHTS_ID_KEY]
      #return ingest_url[:-6] + subscriber_id

    class myHandler(BaseHTTPRequestHandler):
      def do_GET(self):
        new_path = get_insights_dashboard()
        if new_path and new_path != "None":
          self.send_response(307)
          self.send_header('Location', new_path)
          self.end_headers()
</span><span class="hljs-attr">        else:</span>
          <span class="hljs-string">self.send_response(404)</span>
        <span class="hljs-string">self.end_headers()</span>
        <span class="hljs-string">return</span>

<span class="hljs-attr">    try:</span>
      <span class="hljs-string">server</span> <span class="hljs-string">=</span> <span class="hljs-string">HTTPServer(('',</span> <span class="hljs-string">PORT_NUMBER),</span> <span class="hljs-string">myHandler)</span>
      <span class="hljs-string">print</span> <span class="hljs-string">'Started httpserver on port '</span> <span class="hljs-string">,</span> <span class="hljs-string">PORT_NUMBER</span>

      <span class="hljs-comment">#Wait forever for incoming http requests</span>
      <span class="hljs-string">server.serve_forever()</span>

    <span class="hljs-string">except</span> <span class="hljs-attr">KeyboardInterrupt:</span>
      <span class="hljs-string">print</span> <span class="hljs-string">'^C received, shutting down the web server'</span>
      <span class="hljs-string">server.socket.close()</span>

    <span class="hljs-string">EOF</span>
    <span class="hljs-string">)</span>

    <span class="hljs-string">export</span> <span class="hljs-string">PYTHONPATH=/opt/nuodb/drivers/pynuoadmin</span>
    <span class="hljs-string">exec</span> <span class="hljs-string">/opt/nuodb/etc/python/nuopython</span> <span class="hljs-bullet">-c</span> <span class="hljs-string">"${SCRIPT}"</span>

<span class="hljs-meta">---</span>
<span class="hljs-attr">apiVersion:</span> <span class="hljs-string">v1</span>
<span class="hljs-attr">kind:</span> <span class="hljs-string">Pod</span>
<span class="hljs-attr">metadata:</span>
<span class="hljs-attr">  name:</span> <span class="hljs-string">nuodb-insights</span>
<span class="hljs-attr">  labels:</span>
<span class="hljs-attr">    app:</span> <span class="hljs-string">insights</span>
<span class="hljs-attr">    group:</span> <span class="hljs-string">nuodb</span>
<span class="hljs-attr">spec:</span>
<span class="hljs-attr">  initContainers:</span>
<span class="hljs-attr">  - name:</span> <span class="hljs-string">optin</span>
<span class="hljs-attr">    image:</span> <span class="hljs-string">nuodb/nuodb-ce:latest</span>
<span class="hljs-attr">    imagePullPolicy:</span> <span class="hljs-string">IfNotPresent</span>
<span class="hljs-attr">    args:</span>
<span class="hljs-bullet">    -</span> <span class="hljs-string">"/bin/sh"</span>
<span class="hljs-bullet">    -</span> <span class="hljs-string">"-c"</span>
<span class="hljs-bullet">    -</span> <span class="hljs-string">"[ \"${OPT_IN}\" == \"true\" ] &amp;&amp; nuoca enable insights --connect-timeout 300 || nuoca disable insights --connect-timeout 300"</span>
<span class="hljs-attr">    env:</span>
<span class="hljs-bullet">    -</span> <span class="hljs-string">{</span> <span class="hljs-attr">name:</span> <span class="hljs-string">NUOCMD_API_SERVER</span> <span class="hljs-string">,</span> <span class="hljs-attr">value:</span> <span class="hljs-string">"https://domain:8888"</span> <span class="hljs-string">}</span>
<span class="hljs-attr">  containers:</span>
<span class="hljs-attr">  - name:</span> <span class="hljs-string">insights</span>
<span class="hljs-attr">    image:</span> <span class="hljs-string">nuodb/nuodb-ce:latest</span>
<span class="hljs-attr">    imagePullPolicy:</span> <span class="hljs-string">IfNotPresent</span>
<span class="hljs-attr">    args:</span> <span class="hljs-string">[</span> <span class="hljs-string">"nuoca"</span><span class="hljs-string">,</span> <span class="hljs-string">"start"</span> <span class="hljs-string">,</span> <span class="hljs-string">"nuoca"</span><span class="hljs-string">,</span> <span class="hljs-string">"--insights"</span> <span class="hljs-string">]</span>
<span class="hljs-attr">    env:</span>
<span class="hljs-bullet">    -</span> <span class="hljs-string">{</span> <span class="hljs-attr">name:</span> <span class="hljs-string">NUOCMD_API_SERVER</span> <span class="hljs-string">,</span> <span class="hljs-attr">value:</span> <span class="hljs-string">"https://domain:8888"</span> <span class="hljs-string">}</span>
<span class="hljs-attr">    volumeMounts:</span>
<span class="hljs-attr">    - name:</span> <span class="hljs-string">log-volume</span>
<span class="hljs-attr">      mountPath:</span> <span class="hljs-string">/var/log/nuodb</span>
<span class="hljs-attr">    - name:</span> <span class="hljs-string">config-insights</span>
<span class="hljs-attr">      mountPath:</span> <span class="hljs-string">/etc/nuodb/nuoca.yml.template</span>
<span class="hljs-attr">      subPath:</span> <span class="hljs-string">nuoca.yml.template</span>
<span class="hljs-attr">  - name:</span> <span class="hljs-string">insights-server</span>
<span class="hljs-attr">    image:</span> <span class="hljs-string">nuodb/nuodb-ce:latest</span>
<span class="hljs-attr">    imagePullPolicy:</span> <span class="hljs-string">IfNotPresent</span>
<span class="hljs-attr">    args:</span> <span class="hljs-string">[</span> <span class="hljs-string">"nuoinsights"</span> <span class="hljs-string">]</span>
<span class="hljs-attr">    ports:</span>
<span class="hljs-bullet">    -</span> <span class="hljs-string">{</span> <span class="hljs-attr">name:</span> <span class="hljs-number">8080</span><span class="hljs-bullet">-tcp,</span>  <span class="hljs-attr">containerPort:</span> <span class="hljs-number">8080</span><span class="hljs-string">,</span>  <span class="hljs-attr">protocol:</span> <span class="hljs-string">TCP</span> <span class="hljs-string">}</span>
<span class="hljs-attr">    env:</span>
<span class="hljs-bullet">    -</span> <span class="hljs-string">{</span> <span class="hljs-attr">name:</span> <span class="hljs-string">NUOCMD_API_SERVER</span> <span class="hljs-string">,</span> <span class="hljs-attr">value:</span> <span class="hljs-string">"https://domain:8888"</span> <span class="hljs-string">}</span>
<span class="hljs-attr">    volumeMounts:</span>
<span class="hljs-attr">      - name:</span> <span class="hljs-string">log-volume</span>
<span class="hljs-attr">        mountPath:</span> <span class="hljs-string">/var/log/nuodb</span>
<span class="hljs-attr">      - name:</span> <span class="hljs-string">nuoinsights</span>
<span class="hljs-attr">        mountPath:</span> <span class="hljs-string">/usr/local/bin/nuoinsights</span>
<span class="hljs-attr">        subPath:</span> <span class="hljs-string">nuoinsights</span>
<span class="hljs-attr">  volumes:</span>
<span class="hljs-attr">  - name:</span> <span class="hljs-string">log-volume</span>
<span class="hljs-attr">    emptyDir:</span> <span class="hljs-string">{}</span>
<span class="hljs-attr">  - name:</span> <span class="hljs-string">config-insights</span>
<span class="hljs-attr">    configMap:</span>
<span class="hljs-attr">      name:</span> <span class="hljs-string">insights-configmap</span>
<span class="hljs-attr">  - name:</span> <span class="hljs-string">nuoinsights</span>
<span class="hljs-attr">    configMap:</span>
<span class="hljs-attr">      name:</span> <span class="hljs-string">insights-configmap</span>
<span class="hljs-attr">      defaultMode:</span> <span class="hljs-number">0754</span>
</code></pre>
<p><strong>nuodb-sm.yaml</strong></p>
<pre><code class="hljs"><span class="hljs-meta">---</span>
<span class="hljs-attr">apiVersion:</span> <span class="hljs-string">apps/v1beta1</span>
<span class="hljs-attr">kind:</span> <span class="hljs-string">StatefulSet</span>
<span class="hljs-attr">metadata:</span>
<span class="hljs-attr">  name:</span> <span class="hljs-string">sm</span>
<span class="hljs-attr">  labels:</span>
<span class="hljs-attr">    app:</span> <span class="hljs-string">nuodb</span>
<span class="hljs-attr">    group:</span> <span class="hljs-string">nuodb</span>
<span class="hljs-attr">spec:</span>
<span class="hljs-attr">  serviceName:</span> <span class="hljs-string">sm</span>
<span class="hljs-attr">  replicas:</span> <span class="hljs-number">1</span>
<span class="hljs-attr">  selector:</span>
<span class="hljs-attr">    matchLabels:</span>
<span class="hljs-attr">      nodetype:</span> <span class="hljs-string">sm</span>
<span class="hljs-attr">      database:</span> <span class="hljs-string">nuodb</span>
<span class="hljs-attr">      app:</span> <span class="hljs-string">sm</span>
<span class="hljs-attr">      group:</span> <span class="hljs-string">nuodb</span>
<span class="hljs-attr">  podManagementPolicy:</span> <span class="hljs-string">Parallel</span>
<span class="hljs-attr">  template:</span>
<span class="hljs-attr">    metadata:</span>
<span class="hljs-attr">      labels:</span>
<span class="hljs-attr">        nodetype:</span> <span class="hljs-string">sm</span>
<span class="hljs-attr">        database:</span> <span class="hljs-string">nuodb</span>
<span class="hljs-attr">        app:</span> <span class="hljs-string">sm</span>
<span class="hljs-attr">        group:</span> <span class="hljs-string">nuodb</span>
<span class="hljs-attr">    spec:</span>
<span class="hljs-attr">      securityContext:</span>
<span class="hljs-attr">        runAsUser:</span> <span class="hljs-number">1000</span>
<span class="hljs-attr">        fsGroup:</span> <span class="hljs-number">0</span>
<span class="hljs-attr">      containers:</span>
<span class="hljs-attr">      - name:</span> <span class="hljs-string">sm</span>
<span class="hljs-attr">        image:</span> <span class="hljs-string">nuodb/nuodb-ce:latest</span>
<span class="hljs-attr">        imagePullPolicy:</span> <span class="hljs-string">IfNotPresent</span>
<span class="hljs-attr">        args:</span> <span class="hljs-string">[</span> <span class="hljs-string">"nuosm"</span><span class="hljs-string">,</span> <span class="hljs-string">"--servers-ready-timeout"</span><span class="hljs-string">,</span> <span class="hljs-string">"300"</span> <span class="hljs-string">]</span>
<span class="hljs-attr">        env:</span>
<span class="hljs-attr">        - name:</span> <span class="hljs-string">NODE_NAME</span>
<span class="hljs-attr">          valueFrom:</span>
<span class="hljs-attr">            fieldRef:</span>
<span class="hljs-attr">              fieldPath:</span> <span class="hljs-string">spec.nodeName</span>
<span class="hljs-attr">        - name:</span> <span class="hljs-string">POD_NAME</span>
<span class="hljs-attr">          valueFrom:</span>
<span class="hljs-attr">            fieldRef:</span>
<span class="hljs-attr">              fieldPath:</span> <span class="hljs-string">metadata.name</span>
<span class="hljs-attr">        - name:</span> <span class="hljs-string">NAMESPACE</span>
<span class="hljs-attr">          valueFrom:</span>
<span class="hljs-attr">            fieldRef:</span>
<span class="hljs-attr">              fieldPath:</span> <span class="hljs-string">metadata.namespace</span>
<span class="hljs-bullet">        -</span> <span class="hljs-string">{</span> <span class="hljs-attr">name:</span> <span class="hljs-string">DB_NAME,</span> <span class="hljs-attr">value:</span> <span class="hljs-string">"nuodb"</span><span class="hljs-string">}</span>
<span class="hljs-bullet">        -</span> <span class="hljs-string">{</span> <span class="hljs-attr">name:</span> <span class="hljs-string">DB_USER,</span> <span class="hljs-attr">value:</span> <span class="hljs-string">"dba"</span><span class="hljs-string">}</span>
<span class="hljs-bullet">        -</span> <span class="hljs-string">{</span> <span class="hljs-attr">name:</span> <span class="hljs-string">DB_PASSWORD,</span> <span class="hljs-attr">value:</span> <span class="hljs-string">"goalie"</span><span class="hljs-string">}</span>
<span class="hljs-bullet">        -</span> <span class="hljs-string">{</span> <span class="hljs-attr">name:</span> <span class="hljs-string">NUOCMD_API_SERVER,</span>   <span class="hljs-attr">value:</span> <span class="hljs-string">"admin.testns.svc:8888"</span><span class="hljs-string">}</span>
<span class="hljs-bullet">        -</span> <span class="hljs-string">{</span> <span class="hljs-attr">name:</span> <span class="hljs-string">PEER_ADDRESS,</span>        <span class="hljs-attr">value:</span> <span class="hljs-string">"admin.testns.svc"</span> <span class="hljs-string">}</span>
<span class="hljs-bullet">        -</span> <span class="hljs-string">{</span> <span class="hljs-attr">name:</span> <span class="hljs-string">NUODB_OPTIONS,</span>       <span class="hljs-attr">value:</span> <span class="hljs-string">"mem 1g"</span> <span class="hljs-string">}</span>
<span class="hljs-attr">        ports:</span>
<span class="hljs-attr">        - containerPort:</span> <span class="hljs-number">48006</span>
<span class="hljs-attr">          protocol:</span> <span class="hljs-string">TCP</span>
<span class="hljs-attr">        resources:</span>
<span class="hljs-attr">          requests:</span>
<span class="hljs-attr">            memory:</span> <span class="hljs-string">"1Gi"</span>
<span class="hljs-attr">            cpu:</span> <span class="hljs-string">"200m"</span>
<span class="hljs-attr">        terminationMessagePath:</span> <span class="hljs-string">/dev/termination-log</span>
<span class="hljs-attr">        terminationMessagePolicy:</span> <span class="hljs-string">File</span>
<span class="hljs-attr">        volumeMounts:</span>
<span class="hljs-attr">        - mountPath:</span> <span class="hljs-string">/var/opt/nuodb/archive</span>
<span class="hljs-attr">          name:</span> <span class="hljs-string">archive</span>
<span class="hljs-attr">  volumeClaimTemplates:</span>
<span class="hljs-attr">  - metadata:</span>
<span class="hljs-attr">      name:</span> <span class="hljs-string">archive</span>
<span class="hljs-attr">      annotations:</span>
        <span class="hljs-string">volume.beta.kubernetes.io/storage-class:</span> <span class="hljs-string">openebs-cstor-sparse</span>
<span class="hljs-attr">    spec:</span>
<span class="hljs-attr">      accessModes:</span> <span class="hljs-string">[</span> <span class="hljs-string">"ReadWriteOnce"</span> <span class="hljs-string">]</span>
<span class="hljs-attr">      resources:</span>
<span class="hljs-attr">        requests:</span>
<span class="hljs-attr">          storage:</span> <span class="hljs-number">5</span><span class="hljs-string">G</span>
</code></pre>
<p><strong>nuodb-te.yaml</strong></p>
<pre><code class="hljs"><span class="hljs-meta">---</span>
<span class="hljs-attr">apiVersion:</span> <span class="hljs-string">apps/v1beta1</span>
<span class="hljs-attr">kind:</span> <span class="hljs-string">Deployment</span>
<span class="hljs-attr">metadata:</span>
<span class="hljs-attr">  name:</span> <span class="hljs-string">te</span>
<span class="hljs-attr">  labels:</span>
<span class="hljs-attr">    app:</span> <span class="hljs-string">nuodb</span>
<span class="hljs-attr">    group:</span> <span class="hljs-string">nuodb</span>
<span class="hljs-attr">    deploymentconfig:</span> <span class="hljs-string">te</span>
<span class="hljs-attr">spec:</span>
<span class="hljs-attr">  replicas:</span> <span class="hljs-number">1</span>
<span class="hljs-attr">  template:</span>
<span class="hljs-attr">    metadata:</span>
<span class="hljs-attr">      labels:</span>
<span class="hljs-attr">        app:</span> <span class="hljs-string">te</span>
<span class="hljs-attr">        deploymentconfig:</span> <span class="hljs-string">te</span>
<span class="hljs-attr">        database:</span> <span class="hljs-string">nuodb</span>
<span class="hljs-attr">        nodetype:</span> <span class="hljs-string">te</span>
<span class="hljs-attr">    spec:</span>
<span class="hljs-attr">      containers:</span>
<span class="hljs-bullet">      -</span>
<span class="hljs-attr">        name:</span> <span class="hljs-string">te</span>
<span class="hljs-attr">        image:</span> <span class="hljs-string">nuodb/nuodb-ce:latest</span>
<span class="hljs-attr">        imagePullPolicy:</span> <span class="hljs-string">IfNotPresent</span>
<span class="hljs-attr">        env:</span>
<span class="hljs-attr">        - name:</span> <span class="hljs-string">NODE_NAME</span>
<span class="hljs-attr">          valueFrom:</span>
<span class="hljs-attr">            fieldRef:</span>
<span class="hljs-attr">              fieldPath:</span> <span class="hljs-string">spec.nodeName</span>
<span class="hljs-attr">        - name:</span> <span class="hljs-string">POD_NAME</span>
<span class="hljs-attr">          valueFrom:</span>
<span class="hljs-attr">            fieldRef:</span>
<span class="hljs-attr">              fieldPath:</span> <span class="hljs-string">metadata.name</span>
<span class="hljs-attr">        - name:</span> <span class="hljs-string">NAMESPACE</span>
<span class="hljs-attr">          valueFrom:</span>
<span class="hljs-attr">            fieldRef:</span>
<span class="hljs-attr">              fieldPath:</span> <span class="hljs-string">metadata.namespace</span>
<span class="hljs-bullet">        -</span> <span class="hljs-string">{</span> <span class="hljs-attr">name:</span> <span class="hljs-string">DB_NAME,</span>             <span class="hljs-attr">value:</span> <span class="hljs-string">"nuodb"</span> <span class="hljs-string">}</span>
<span class="hljs-bullet">        -</span> <span class="hljs-string">{</span> <span class="hljs-attr">name:</span> <span class="hljs-string">NUOCMD_API_SERVER,</span>   <span class="hljs-attr">value:</span> <span class="hljs-string">"admin.testns.svc:8888"</span><span class="hljs-string">}</span>
<span class="hljs-bullet">        -</span> <span class="hljs-string">{</span> <span class="hljs-attr">name:</span> <span class="hljs-string">PEER_ADDRESS,</span>        <span class="hljs-attr">value:</span> <span class="hljs-string">"admin.testns.svc"</span> <span class="hljs-string">}</span>
<span class="hljs-bullet">        -</span> <span class="hljs-string">{</span> <span class="hljs-attr">name:</span> <span class="hljs-string">NUODB_LABELS,</span>        <span class="hljs-attr">value:</span> <span class="hljs-string">""</span> <span class="hljs-string">}</span>
<span class="hljs-bullet">        -</span> <span class="hljs-string">{</span> <span class="hljs-attr">name:</span> <span class="hljs-string">NUODB_OPTIONS,</span>       <span class="hljs-attr">value:</span> <span class="hljs-string">"mem 1g"</span> <span class="hljs-string">}</span>
<span class="hljs-attr">        args:</span> <span class="hljs-string">[</span> <span class="hljs-string">"nuote"</span><span class="hljs-string">,</span> <span class="hljs-string">"--servers-ready-timeout"</span><span class="hljs-string">,</span> <span class="hljs-string">"300"</span><span class="hljs-string">,</span> <span class="hljs-string">"--database-created-timeout"</span><span class="hljs-string">,</span> <span class="hljs-string">"300"</span> <span class="hljs-string">]</span>
<span class="hljs-attr">        ports:</span>
<span class="hljs-attr">        - containerPort:</span> <span class="hljs-number">48006</span>
<span class="hljs-attr">          protocol:</span> <span class="hljs-string">TCP</span>
<span class="hljs-attr">        resources:</span>
<span class="hljs-attr">          requests:</span>
<span class="hljs-attr">            memory:</span> <span class="hljs-string">"1Gi"</span>
<span class="hljs-attr">            cpu:</span> <span class="hljs-string">"200m"</span>
<span class="hljs-attr">        terminationMessagePath:</span> <span class="hljs-string">/dev/termination-log</span>
<span class="hljs-attr">        terminationMessagePolicy:</span> <span class="hljs-string">File</span>
<span class="hljs-attr">        volumeMounts:</span>
<span class="hljs-attr">        - name:</span> <span class="hljs-string">logdir</span>
<span class="hljs-attr">          mountPath:</span> <span class="hljs-string">/var/log/nuodb</span>
<span class="hljs-attr">      volumes:</span>
<span class="hljs-attr">        - name:</span> <span class="hljs-string">logdir</span>
<span class="hljs-attr">          emptyDir:</span> <span class="hljs-string">{}</span>
</code></pre>
<p><br></p>
<hr>
<p><br></p>
<h2><a class="anchor" aria-hidden="true" id="see-also"></a><a href="#see-also" aria-hidden="true" class="hash-link" ><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>See Also:</h2>
<p><br></p>
<hr>
<p><br></p>
<h3><a class="anchor" aria-hidden="true" id="openebs-architecture-docs-next-architecturehtml"></a><a href="#openebs-architecture-docs-next-architecturehtml" aria-hidden="true" class="hash-link" ><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><a href="/docs/next/architecture.html">OpenEBS architecture</a></h3>
<h3><a class="anchor" aria-hidden="true" id="openebs-use-cases-docs-next-usecaseshtml"></a><a href="#openebs-use-cases-docs-next-usecaseshtml" aria-hidden="true" class="hash-link" ><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><a href="/docs/next/usecases.html">OpenEBS use cases</a></h3>
<h3><a class="anchor" aria-hidden="true" id="cstor-pools-overview-docs-next-cstorhtml-cstor-pools"></a><a href="#cstor-pools-overview-docs-next-cstorhtml-cstor-pools" aria-hidden="true" class="hash-link" ><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><a href="/docs/next/cstor.html#cstor-pools">cStor pools overview</a></h3>
<p><br></p>
<hr>
<p><br></p>
<!-- Hotjar Tracking Code for https://docs.openebs.io -->
<script>
   (function(h,o,t,j,a,r){
       h.hj=h.hj||function(){(h.hj.q=h.hj.q||[]).push(arguments)};
       h._hjSettings={hjid:785693,hjsv:6};
       a=o.getElementsByTagName('head')[0];
       r=o.createElement('script');r.async=1;
       r.src=t+h._hjSettings.hjid+j+h._hjSettings.hjsv;
       a.appendChild(r);
   })(window,document,'https://static.hotjar.com/c/hotjar-','.js?sv=');
</script>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-92076314-12"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
<p>gtag('config', 'UA-92076314-12');</p>
</script>
</span></div></article></div><div class="docs-prevnext"><a class="docs-prev button" href="cassandra.html">← OpenEBS for Cassandra</a><a class="docs-next button" href="postgres.html">OpenEBS for PostgreSQL →</a></div></div></div><nav class="onPageNav"><div id="global-on-page-heading"><h4 style="font-weight:400;">On this page:</h4><ul class="toc-headings"><li><a href="#introduction">Introduction</a></li><li><a href="#deployment-model">Deployment model</a></li><li><a href="#configuration-workflow">Configuration workflow</a></li><li><a href="#reference-at-openebsci-https-openebsci">Reference at <a href="https://openebs.ci/">openebs.ci</a></a></li><li><a href="#post-deployment-operations">Post deployment Operations</a></li><li><a href="#configuration-details">Configuration details</a></li><li><a href="#see-also">See Also:</a><ul class="toc-headings"><li><a href="#openebs-architecture-docs-next-architecturehtml">OpenEBS architecture</a></li><li><a href="#openebs-use-cases-docs-next-usecaseshtml">OpenEBS use cases</a></li><li><a href="#cstor-pools-overview-docs-next-cstorhtml-cstor-pools">cStor pools overview</a></li></ul></li></ul></div></nav></div><footer class="nav-footer" id="footer"><section class="sitemap"><div><br/><div><a href="https://openebs.io" target="_blank"><img src="/docs/assets/openebs-logo.svg" alt="" width="130" height="110"/></a></div><div><a href="https://slack.openebs.io">Get in touch with OpenEBS community via Slack</a></div></div><div><br/><div><a href="https://mayadata.io" target="_blank"><img src="https://openebs.io/assets/images/mayadata.svg" alt="mayadata.io" width="130" height="110"/></a></div><div><a href="https://app.mayaonline.io">Get OpenEBS support through MayaOnline</a></div></div></section><section class="copyright"></section></footer></div><script type="text/javascript" src="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.js"></script><script>
              var search = docsearch({
                
                apiKey: 'dc657dfe30f42f228671f557f49ced7a',
                indexName: 'openebs',
                inputSelector: '#search_input_react'
              });
            </script><script>(function(){ window.ldfdr = window.ldfdr || {}; (function(d, s, ss, fs){ fs = d.getElementsByTagName(s)[0]; function ce(src){ var cs = d.createElement(s); cs.async=1; cs.src = src; setTimeout(function(){fs.parentNode.insertBefore(cs,fs)}, 1); } ce(ss); })(document, 'script', 'https://lftracker.leadfeeder.com/lftracker_v1_bMwm7E2pzw4gOZyA.js'); })();</script></body></html>